# i18n 管理工具

本目录包含用于管理国际化翻译的综合工具脚本。

## 📋 工具说明

### check_status.dart - 综合检查与清理工具 ⭐

**一站式解决方案**，包含所有 i18n 管理功能：

1. **检查翻译文件完整性**
   - 显示所有语言的翻译键数量和完成度
   - 对比中文基准版本，列出每个语言缺失的键
   - 检查空值翻译

2. **检查各语言多余的 keys**
   - 以简体中文为基准
   - 找出其他语言（en, zh_TW）中多余的键
   - 提供清理选项

3. **检测未使用的翻译 key**
   - 扫描所有 Dart 代码文件（自动排除 `lib/l10n/` 生成文件）
   - 列出未被引用的翻译键
   - 提供清理选项

**使用方法：**

```bash
dart scripts/i18n/check_status.dart
```

**工作流程：**

该脚本会按顺序执行三个检查步骤：

1. **第一步：翻译完整性检查**
   - 显示统计表格和详细分析
   - 检查空值

2. **第二步：检查多余的 keys**
   - 如果发现多余的键，会列出详情
   - 询问是否清理：输入 `y` 或 `yes` 确认

3. **第三步：检查未使用的 keys**
   - 如果发现未使用的键，会列出详情
   - 询问是否清理：输入 `y` 或 `yes` 确认

**输出示例：**

```
======================================================================
  BeeCount 国际化翻译状态检查
======================================================================

📊 第一步：检查翻译文件完整性

语言代码 | 文件名称        | 键数量   | 完成度   | 状态
----------------------------------------------------------------------
zh       | app_zh.arb      |    1064 |   100.0% | ✅ 完整
en       | app_en.arb      |    1064 |   100.0% | ✅ 完整
zh_TW    | app_zh_TW.arb   |    1064 |   100.0% | ✅ 完整
----------------------------------------------------------------------

📋 详细分析:

✅ en (English): 完全匹配中文版本
✅ zh_TW (繁體中文): 完全匹配中文版本

🔍 检查空值翻译:

✅ 所有翻译都有值

📈 总结:
  基准语言: 简体中文 (zh) - 1064 个键
  完整翻译: 3/3 个语言
  待完善: 0 个语言

🎉 所有翻译文件状态良好！

----------------------------------------------------------------------

🔍 第二步：检查各语言多余的 keys

📊 基准文件 (app_zh.arb): 1064 个键

✅ 没有发现多余的键！

----------------------------------------------------------------------

🔍 第三步：检查未使用的翻译 key

📊 总共有 1064 个翻译 keys
📁 扫描 148 个 Dart 文件...

✅ 使用中的 keys: 1050
❌ 未使用的 keys: 14

📝 未使用的 keys 列表：
============================================================
  • oldKeyExample1: "示例文本1"
  • oldKeyExample2: "示例文本2"
  ...
============================================================

----------------------------------------------------------------------

⚠️  是否要清理这些未使用的 keys？(y/N):
```

**清理操作：**

- 如果选择清理（输入 `y`），脚本会：
  1. 从所有语言文件中删除对应的 keys 和元数据
  2. 格式化 JSON 文件
  3. 提示运行 `flutter gen-l10n` 重新生成代码

- 如果选择不清理（输入 `N` 或直接回车），会跳过清理步骤

**清理后需要：**

```bash
flutter gen-l10n
```

## 🔄 使用流程

### 日常检查

只需运行一个命令：

```bash
dart scripts/i18n/check_status.dart
```

### 完整工作流

1. **运行检查脚本**
   ```bash
   dart scripts/i18n/check_status.dart
   ```

2. **根据提示选择是否清理**
   - 检查多余 keys 后，输入 `y` 或 `N`
   - 检查未使用 keys 后，输入 `y` 或 `N`

3. **如果进行了清理，重新生成代码**
   ```bash
   flutter gen-l10n
   ```

4. **提交更改**
   ```bash
   git add lib/l10n/*.arb
   git commit -m "chore: 清理未使用的翻译keys"
   ```

## 💡 最佳实践

1. **定期检查**：每次发布前运行一次
2. **先预览后清理**：仔细查看要删除的 key 列表再确认
3. **保持同步**：添加新 key 时同时更新所有语言（zh, en, zh_TW）
4. **版本控制**：翻译文件的变更要提交到 git
5. **人工审核**：翻译后建议请母语使用者校对
6. **清理前备份**：重要项目建议先提交当前更改

## 🔧 技术说明

### 翻译完整性检查

- 以简体中文为基准语言
- 对比其他语言文件的键集合
- 显示缺失、多余和空值情况

### 多余 keys 检查

- 基准对比：以简体中文为标准
- 找出其他语言中多出的键（通常来自合并代码或复制错误）
- 安全清理：删除前需手动确认

### 未使用 keys 检测

- **智能过滤**：自动排除 `lib/l10n/` 目录下的生成文件
- **多种匹配模式**：
  - `l10n.key`
  - `l10n!.key`
  - `AppLocalizations.of(context).key`
- **正则表达式**：识别复杂的引用场景
- **安全清理**：删除前需手动确认，防止误删

### JSON 格式化

- 清理后自动格式化 JSON
- 使用 2 空格缩进
- 保持文件整洁一致

## 📝 支持的语言

当前支持以下 3 种语言：

- **简体中文 (zh)** - 基准语言
- **English (en)**
- **繁體中文 (zh_TW)**

## ⚠️ 注意事项

1. **备份重要数据**：清理操作不可逆，建议提前 commit
2. **仔细审查列表**：确认要删除的 keys 确实不需要
3. **重新生成代码**：清理后务必运行 `flutter gen-l10n`
4. **测试应用**：清理后建议运行应用确保没有遗漏的翻译引用
